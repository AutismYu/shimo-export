# 石墨文档导出脚本
这是一个 Tampermonkey 脚本。  

石墨文档无疑是我用过的最好用的在线文档之一。  
但是他不提供批量导出功能，提高了自备份数据、转移数据的门槛。   
（说实话国内一堆网站都这幅德行，数据不方便备份的话，一旦账号被封或者服务器异常，抢救会很困难）   

我写了这个脚本，虽然可以一键导出，但是**因为石墨官方的限制，速度完全不合理**。    
石墨官方的速度限制是一分钟内最多可以导出6个文件。   
当你导出第一个文件的时候，他就会开始监测，当你导出6个，试着导出第7个的时候，他会说：“请你等待xx秒。”    
既然官方有限制，我就尽量模拟真人操作，每导出一个就会暂停3秒。   

你手动点导出也一样，你很快就导出了6个，然后再点导出什么都不发生了，得等几十秒之后才行。  

```json
HTTP: 429
{
    "requestId": "9d4d6fa4b58cfe7e081683888aa88888",
    "error": "Rate limit exceeded, retry in 23 seconds",
    "errorCode": 0
}
```

# 测试
2021年03月19日 测试：  
- 可用版本：个人免费版、企业免费试用版   
- 可用桌面：原版、新版（内测）
- 速度：一键导出65个文件用时 14.1 分钟。    

看的出来，企业版的免费试用版还是会限制下载的速度（1分钟6个）。  

# 截图
![截图afda](https://s3.ax1x.com/2021/03/19/6R7YkV.png)   
![截图gfdfhd](https://s3.ax1x.com/2021/03/19/6RhDmV.png)  
![截图0dfhgdh2](https://s3.ax1x.com/2021/03/19/6RhPQ1.png)    
![截图gfhhte3](https://s3.ax1x.com/2021/03/19/6RhtYQ.png)   

# 安装、使用
安装脚本： [greasy fork](https://greasyfork.org/zh-CN/scripts/423544-%E7%9F%B3%E5%A2%A8%E6%96%87%E6%A1%A3%E6%89%B9%E9%87%8F%E5%AF%BC%E5%87%BA)       
**注意：我的API使用是按照 Tampermonkey 来编写的，不保证支持其他的脚本扩展（比如 Greasemonkey）。**    

在石墨文档的页面，打开脚本菜单，可以看见“设置导出的格式”和“点我开始导出”。   
第一次使用应该先设置导出的格式，或者不设置就是我默认的格式了。  
导出的时候，你必须先把网页打开到你需要导出的文件夹的页面。比如你要导出“账本”文件夹，就把网页打开到“账本”文件夹里面就好。    
如果你要导出全部文件，就网页打开到桌面。   
脚本会自动扫描这个文件夹的子文件和所有子文件夹里面的文件。   
扫描完成后一个一个地下载到缓存里。  
下载完成之后，会生成一个 zip 压缩包，浏览器会弹出下载框，直接下载这个 zip 压缩包即可。  

要隐藏我的黑框框，你需要刷新当前网页。   

# 使用的第三方类库
- [jszip](https://stuk.github.io/jszip/)  

# 源码
- [github](https://github.com/gordonwalkedby/shimo-export)   
- [gitee 镜像](https://gitee.com/walkedby/shimo-export)    
